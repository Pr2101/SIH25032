<!DOCTYPE html>
<html>
<head>
    <title>Landmark App</title>
    <!-- Add Leaflet CSS and JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script src="./api-bridge.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: url('https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1600') center/cover fixed;
            color: white;
        }
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        h1 {
            margin: 0;
            font-size: 2em;
        }
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            margin-bottom: 80px;
        }
        .message {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            max-width: 85%;
            font-size: 15px;
            line-height: 1.5;
            white-space: pre-wrap;
        }
        .message img {
            max-width: 100%;
            border-radius: 10px;
            margin: 10px 0;
        }
        .message.user-message {
            margin-left: auto;
            background: rgba(0, 123, 255, 0.3);
            color: white;
            width: fit-content;
        }
        .message.user-message img {
            max-width: 300px;
            height: auto;
            display: block;
            margin: 10px auto;
        }
        .message.ai-message {
            margin-right: auto;
            background: rgba(0, 0, 0, 0.7);
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            width: fit-content;
        }
        .ai-message h1, .ai-message h2, .ai-message h3 {
            color: #4CAF50;
            margin: 15px 0 10px 0;
            font-weight: 600;
        }
        .ai-message ul, .ai-message ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        .ai-message li {
            margin: 5px 0;
        }
        .ai-message strong, .ai-message b {
            color: #4CAF50;
        }
        .ai-message hr {
            border: none;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            margin: 15px 0;
        }
        .input-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .input-field {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }
        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 46px;
            height: 46px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }
        button:hover {
            background: #0056b3;
        }
        #imagePreview {
            max-width: 300px;
            max-height: 200px;
            margin: 10px 0;
            border-radius: 10px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: white;
            display: none;
        }
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }
        .recording {
            animation: pulse 1.5s infinite;
            background: #dc3545 !important;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .voice-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            display: none;
            text-align: center;
        }

        .voice-indicator.active {
            display: block;
        }

        .voice-waves {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 3px;
            margin-top: 10px;
        }

        .wave {
            width: 3px;
            height: 20px;
            background: white;
            animation: wave 1s infinite;
        }

        .wave:nth-child(2) { animation-delay: 0.1s; }
        .wave:nth-child(3) { animation-delay: 0.2s; }
        .wave:nth-child(4) { animation-delay: 0.3s; }
        .wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes wave {
            0% { height: 20px; }
            50% { height: 40px; }
            100% { height: 20px; }
        }

        .language-selector {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .language-selector.active {
            display: block;
        }

        .language-selector select {
            background: rgba(30, 30, 30, 0.95);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.4);
            padding: 8px 12px;
            border-radius: 5px;
            width: 200px;
            margin-bottom: 12px;
            font-size: 14px;
            cursor: pointer;
        }

        .language-selector select:hover {
            background: rgba(40, 40, 40, 0.95);
            border-color: rgba(255, 255, 255, 0.6);
        }

        .language-selector select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        .language-selector select option {
            background: #1e1e1e;
            color: white;
            padding: 8px;
            font-size: 14px;
        }

        .language-selector select option:hover {
            background: #2c2c2c;
        }

        .language-selector label {
            display: block;
            margin-bottom: 8px;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .language-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 15px;
            color: white;
            font-size: 12px;
        }

        .quick-translate {
            position: relative;
            display: inline-block;
        }

        .translate-box {
            position: absolute;
            bottom: 55px;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            padding: 10px;
            border-radius: 8px;
            display: none;
            width: 200px;
        }

        .translate-box.active {
            display: block;
        }

        .translate-box input {
            width: 100%;
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            margin-bottom: 5px;
        }

        .translate-box button {
            width: 100%;
            border-radius: 4px;
            margin-top: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .speaking {
            animation: speak 1s infinite;
            background: #4CAF50 !important;
        }
        
        @keyframes speak {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .weather-btn {
            position: absolute;
            left: 20px;
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
            transition: transform 0.3s ease;
        }

        .weather-btn:hover {
            transform: scale(1.1);
        }

        .weather-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            background-image: linear-gradient(45deg,#2f4689,#500ae4);
            padding: 40px;
            border-radius: 10px;
            width: 90%;
            max-width: 470px;
            display: none;
        }

        .weather-container .search-bar {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            margin-bottom: 20px;
        }

        .weather-container .search-bar input {
            height: 50px;
            width: 100%;
            border: none;
            outline: none;
            border-radius: 40px;
            padding-left: 25px;
            color: #626262;
            background: #ebfffc;
            font-size: 18px;
        }

        .weather-container .search-bar button {
            width: 40px;
            height: 40px;
            cursor: pointer;
            padding: 10px;
            background: #ebfffc;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .weather-container .search-bar button img {
            width: 20px;
            height: 20px;
        }

        .weather-container .weather-icon {
            text-align: center;
            margin: 30px 0;
        }

        .weather-container .weather-icon img {
            width: 170px;
        }

        .weather-container .weather-info {
            text-align: center;
            color: #fff;
        }

        .weather-container .city {
            font-size: 40px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .weather-container .temp {
            font-size: 70px;
            font-weight: 500;
            margin: 0;
        }

        .weather-container .weather-details {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            margin-top: 50px;
        }

        .weather-container .col {
            display: flex;
            align-items: center;
            text-align: left;
            gap: 10px;
        }

        .weather-container .col img {
            width: 40px;
        }

        .weather-container .col p {
            color: #fff;
            font-size: 16px;
            margin: 0;
        }

        .weather-container .humidity,
        .weather-container .wind {
            font-size: 28px;
            margin-top: -6px;
        }

        .weather-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        .notification button {
            background: transparent;
            border: 1px solid white;
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .notification button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .currency-btn {
            position: absolute;
            left: 70px;
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
            transition: transform 0.3s ease;
        }

        .currency-btn:hover {
            transform: scale(1.1);
            color: #4CAF50;
        }

        .currency-converter {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            background-image: linear-gradient(45deg,#2f4689,#500ae4);
            padding: 40px;
            border-radius: 10px;
            width: 90%;
            max-width: 470px;
            display: none;
        }

        .currency-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .converter-inputs {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .input-group input {
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .input-group select {
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            cursor: pointer;
            font-size: 14px;
        }

        .input-group select:hover {
            background: rgba(0, 0, 0, 0.8);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .input-group select:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }

        .input-group select option {
            background: #1a1a1a;
            color: white;
            padding: 8px;
            font-size: 14px;
        }

        .input-group select option:hover {
            background: #2c2c2c;
        }

        .swap-btn {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
        }

        .swap-btn:hover {
            color: #4CAF50;
        }

        .convert-btn {
            width: 100%;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .convert-btn:hover {
            background: #45a049;
        }

        .emergency-numbers {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            display: none;
            text-align: center;
        }

        .emergency-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .search-bar {
            margin-bottom: 20px;
        }

        .search-bar input {
            width: 100%;
            padding: 10px;
            border: none;
            outline: none;
            border-radius: 40px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 18px;
        }

        .emergency-list {
            text-align: left;
        }

        .emergency-list p {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }

        .emergency-btn {
            position: absolute;
            left: 120px;
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
            transition: transform 0.3s ease;
        }

        .emergency-btn:hover {
            transform: scale(1.1);
            color: #ff4444;
        }

        .country-item {
            background: rgba(255, 255, 255, 0.1);
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .country-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .country-item h4 {
            color: #4CAF50;
            margin: 0 0 10px 0;
        }

        .country-item p {
            margin: 5px 0;
            color: white;
        }

        .emergency-numbers {
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .emergency-list {
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 10px;
        }

        .emergency-list::-webkit-scrollbar {
            width: 8px;
        }

        .emergency-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .emergency-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        .emergency-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        .planner-btn {
            position: absolute;
            left: 170px;
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
            transition: transform 0.3s ease;
        }

        .planner-btn:hover {
            transform: scale(1.1);
            color: #4CAF50;
        }

        .holiday-planner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 15px;
            display: none;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            color: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .planner-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .planner-inputs {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .planner-inputs input {
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }

        .days-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .days-input input {
            width: 80px;
        }

        .generate-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            display: block;
        }

        .generate-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .generate-btn:active {
            transform: translateY(0);
        }

        .plan-content {
            margin-top: 20px;
            font-size: 16px;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .plan-content b {
            color: #4CAF50;
            font-weight: 600;
            display: inline-block;
            margin-right: 5px;
        }

        .plan-content br {
            display: block;
            content: "";
            margin-top: 15px;
        }

        .plan-content br + br {
            margin-top: 30px;
        }

        .plan-content ul {
            list-style-type: none;
            padding-left: 20px;
            margin: 15px 0;
        }

        .plan-content li {
            margin: 10px 0;
            line-height: 1.6;
            position: relative;
            padding-left: 25px;
        }

        .plan-content li:before {
            content: "•";
            color: #4CAF50;
            position: absolute;
            left: 0;
            font-size: 20px;
        }

        .day-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
            border-left: 4px solid #4CAF50;
        }

        .time-section {
            margin: 20px 0;
            padding-left: 15px;
            border-left: 2px solid rgba(76, 175, 80, 0.5);
        }

        .planner-result {
            margin-top: 20px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 12px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .planner-result::-webkit-scrollbar {
            width: 8px;
        }

        .planner-result::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .planner-result::-webkit-scrollbar-thumb {
            background: rgba(76, 175, 80, 0.5);
            border-radius: 4px;
        }

        .planner-result::-webkit-scrollbar-thumb:hover {
            background: rgba(76, 175, 80, 0.7);
        }

        /* Map styles */
        .map-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: none;
        }

        .map-container.active {
            display: block;
        }

        .map-search-bar {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1001;
            width: 300px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .map-search-bar form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .map-search-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            background: white;
        }

        .map-search-button {
            padding: 10px 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            transition: background-color 0.2s;
        }

        .map-search-button:hover {
            background: #45a049;
        }

        .map-close {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1001;
            background: white;
            border: none;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .transport-modes {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1001;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            display: flex;
            gap: 10px;
        }

        .transport-mode-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .transport-mode-btn.active {
            background: #4CAF50;
            color: white;
            border-color: #45a049;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        @media print {
            .plan-container {
                background: white;
                color: black;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <button onclick="toggleWeather()" class="weather-btn" title="Weather">
                <i class="fas fa-cloud-sun"></i>
            </button>
            <button onclick="toggleCurrencyConverter()" class="currency-btn" title="Currency Converter">
                <i class="fas fa-exchange-alt"></i>
            </button>
            <button onclick="toggleEmergencyNumbers()" class="emergency-btn" title="Emergency Numbers">
                <i class="fas fa-phone-alt"></i>
            </button>
            <button onclick="toggleHolidayPlanner()" class="planner-btn" title="Holiday Planner">
                <i class="fas fa-calendar-alt"></i>
            </button>
            <h1>Landmark App</h1>
        </div>
        
        <!-- Add map container -->
        <div class="map-container" id="mapContainer">
            <div class="map-search-bar">
                <form id="routeForm">
                    <input type="text" id="sourceLocation" class="map-search-input" placeholder="Enter source location...">
                    <input type="text" id="destLocation" class="map-search-input" placeholder="Enter destination...">
                    <button type="submit" class="map-search-button">Get Route</button>
                </form>
            </div>
            <div id="map"></div>
            <div class="transport-modes">
                <button class="transport-mode-btn active" data-mode="driving">🚗 Driving</button>
                <button class="transport-mode-btn" data-mode="walking">🚶 Walking</button>
                <button class="transport-mode-btn" data-mode="cycling">🚲 Cycling</button>
            </div>
            <button class="map-close" onclick="toggleMap()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="chat-container" id="chatContainer">
            <!-- Messages will be added here dynamically -->
        </div>

        <div class="voice-indicator" id="voiceIndicator">
            <div>Listening...</div>
            <div class="voice-waves">
                <div class="wave"></div>
                <div class="wave"></div>
                <div class="wave"></div>
                <div class="wave"></div>
                <div class="wave"></div>
            </div>
        </div>

        <div class="loading" id="loading">
            Processing... Please wait...
        </div>

        <div class="input-container">
            <input type="text" class="input-field" id="textInput" placeholder="Type your question...">
            <div class="action-buttons">
                <button onclick="sendText()" title="Send">
                    <i class="fas fa-paper-plane"></i>
                </button>
                <div class="file-input-wrapper">
                    <button title="Upload Image">
                        <i class="fas fa-camera"></i>
                    </button>
                    <input type="file" id="imageInput" accept="image/*" onchange="previewImage(event)">
                </div>
                <button id="micButton" onclick="toggleVoiceRecognition()" title="Voice Input">
                    <i class="fas fa-microphone"></i>
                </button>
                <button id="voiceButton" onclick="toggleTextToSpeech()" title="Text to Speech">
                    <i class="fas fa-volume-up"></i>
                </button>
                <div class="quick-translate">
                    <button onclick="toggleTranslateBox()" title="Quick Translate">
                        <i class="fas fa-language"></i>
                    </button>
                    <div class="translate-box" id="translateBox">
                        <input type="text" id="quickLangInput" placeholder="Enter language (e.g. Spanish)">
                        <button onclick="quickTranslate()">
                            <i class="fas fa-language"></i> Translate & Speak
                        </button>
                    </div>
                </div>
                <button onclick="toggleSettings()" title="Settings">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>

        <div class="language-selector" id="languageSelector">
            <label for="inputLang">Input Language:</label>
            <select id="inputLang">
                <option value="auto">Auto Detect</option>
                <option value="en">English</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
                <option value="de">German</option>
                <option value="it">Italian</option>
                <option value="pt">Portuguese</option>
                <option value="ru">Russian</option>
                <option value="ja">Japanese</option>
                <option value="ko">Korean</option>
                <option value="zh">Chinese</option>
                <option value="hi">Hindi</option>
                <option value="ar">Arabic</option>
            </select>
            <label for="outputLang">Output Language:</label>
            <select id="outputLang">
                <option value="en">English</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
                <option value="de">German</option>
                <option value="it">Italian</option>
                <option value="pt">Portuguese</option>
                <option value="ru">Russian</option>
                <option value="ja">Japanese</option>
                <option value="ko">Korean</option>
                <option value="zh">Chinese</option>
                <option value="hi">Hindi</option>
                <option value="ar">Arabic</option>
            </select>
        </div>

        <div class="language-indicator" id="languageIndicator">
            Input: Auto | Output: English
        </div>

        <div id="weatherContainer" class="weather-container">
            <button class="weather-close" onclick="toggleWeather()">
                <i class="fas fa-times"></i>
            </button>
            <div class="search-bar">
                <input type="text" id="cityInput" placeholder="Enter city name" />
                <button onclick="searchWeather()" class="search-button">
                    <img src="Images/Search.jpeg" alt="Search" />
                </button>
            </div>
            <div id="weatherContent"></div>
        </div>

        <div id="currencyConverter" class="currency-converter">
            <button class="currency-close" onclick="toggleCurrencyConverter()">
                <i class="fas fa-times"></i>
            </button>
            <h3>Currency Converter</h3>
            <div class="converter-inputs">
                <div class="input-group">
                    <input type="number" id="amount" placeholder="Amount" value="1">
                    <select id="fromCurrency">
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                        <option value="JPY">JPY</option>
                        <option value="AUD">AUD</option>
                        <option value="CAD">CAD</option>
                        <option value="CHF">CHF</option>
                        <option value="CNY">CNY</option>
                        <option value="INR">INR</option>
                    </select>
                </div>
                <button class="swap-btn" onclick="swapCurrencies()">
                    <i class="fas fa-exchange-alt"></i>
                </button>
                <div class="input-group">
                    <input type="number" id="result" readonly>
                    <select id="toCurrency">
                        <option value="EUR">EUR</option>
                        <option value="USD">USD</option>
                        <option value="GBP">GBP</option>
                        <option value="JPY">JPY</option>
                        <option value="AUD">AUD</option>
                        <option value="CAD">CAD</option>
                        <option value="CHF">CHF</option>
                        <option value="CNY">CNY</option>
                        <option value="INR">INR</option>
                    </select>
                </div>
            </div>
            <button class="convert-btn" onclick="convertCurrency()">Convert</button>
        </div>

        <div id="emergencyNumbers" class="emergency-numbers">
            <button class="emergency-close" onclick="toggleEmergencyNumbers()">
                <i class="fas fa-times"></i>
            </button>
            <h3>Emergency Numbers</h3>
            <div class="search-bar">
                <input type="text" id="countrySearch" placeholder="Search country..." oninput="filterCountries()">
            </div>
            <div class="emergency-list" id="emergencyList">
                <!-- Emergency numbers will be populated here -->
            </div>
        </div>

        <div class="holiday-planner" id="holidayPlanner">
            <button class="planner-close" onclick="toggleHolidayPlanner()">
                <i class="fas fa-times"></i>
            </button>
            <h3>Holiday Planner</h3>
            <div class="planner-inputs">
                <input type="text" id="destination" placeholder="Enter destination...">
                <div class="days-input">
                    <label>Number of days:</label>
                    <input type="number" id="days" min="1" max="14" value="3">
                </div>
                <button onclick="generatePlan()" class="generate-btn">Generate Plan</button>
                <button onclick="toggleMap()" class="generate-btn" style="background: #2196F3;">
                    <i class="fas fa-map-marker-alt"></i> Open Route Map
                </button>
            </div>
            <div class="planner-result" id="plannerResult"></div>
        </div>
    </div>

    <script>
        let currentImageData = null;
        let isSpeaking = false;
        let isRecording = false;
        let speechSynthesis = window.speechSynthesis;
        let recognition = null;
        let currentUtterance = null;
        let currentInputLang = 'auto';
        let currentOutputLang = 'en';
        let map;
        let routingControl;
        let currentTransportMode = 'driving';

        function addMessage(text, isUser = false, imageData = null) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;

            if (imageData) {
                const img = document.createElement('img');
                img.src = imageData;
                messageDiv.appendChild(img);
            }

            // Clean up the text by removing # symbols and extra spaces
            let formattedText = text
                .replace(/^#+\s*/gm, '') // Remove # at the start of lines
                .replace(/\s*\*\*Travel Recommendations:\*\*/g, 'Travel Recommendations:') // Clean up travel recommendations header
                .trim();

            // Convert markdown-style formatting to HTML
            formattedText = formattedText
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/^(.*?):$/gm, '<h3>$1</h3>') // Convert lines ending with colon to headers
                .replace(/\n/g, '<br>')
                .replace(/•/g, '•')
                .replace(/- /g, '• ');

            // Handle bullet points
            const bulletPoints = formattedText.split('• ');
            if (bulletPoints.length > 1) {
                formattedText = bulletPoints[0] + '<ul>' + 
                    bulletPoints.slice(1).map(point => {
                        if (point.trim()) {
                            return `<li>${point.trim()}</li>`;
                        }
                        return '';
                    }).join('') + '</ul>';
            }

            messageDiv.innerHTML += formattedText;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentImageData = e.target.result;
                    addMessage('Image uploaded, processing...', true, currentImageData);
                    sendImage();
                }
                reader.readAsDataURL(file);
            }
        }

        async function sendText() {
            const textInput = document.getElementById('textInput');
            const text = textInput.value.trim();
            
            if (!text) {
                return;
            }

            addMessage(text, true);
            showLoading();
            
            try {
                // Add language instructions to the prompt
                const languagePrompt = currentOutputLang !== 'en' 
                    ? `Please respond in ${document.getElementById('outputLang').options[document.getElementById('outputLang').selectedIndex].text}. `
                    : '';
                const response = await window.api.sendText(languagePrompt + text);
                addMessage(response);
            } catch (error) {
                addMessage('Error: ' + error);
            } finally {
                hideLoading();
                textInput.value = '';
            }
        }

        async function sendImage() {
            if (!currentImageData) {
                return;
            }

            showLoading();
            try {
                const response = await window.api.sendImage(currentImageData);
                addMessage(response);
            } catch (error) {
                addMessage('Error: ' + error);
            } finally {
                hideLoading();
                currentImageData = null;
            }
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function toggleSettings() {
            const languageSelector = document.getElementById('languageSelector');
            languageSelector.classList.toggle('active');
        }

        function updateLanguageIndicator() {
            const indicator = document.getElementById('languageIndicator');
            const inputLang = document.getElementById('inputLang').value;
            const outputLang = document.getElementById('outputLang').value;
            indicator.textContent = `Input: ${inputLang === 'auto' ? 'Auto' : inputLang.toUpperCase()} | Output: ${outputLang.toUpperCase()}`;
        }

        function setupLanguageSelectors() {
            const inputLang = document.getElementById('inputLang');
            const outputLang = document.getElementById('outputLang');

            inputLang.addEventListener('change', function() {
                currentInputLang = this.value;
                updateLanguageIndicator();
            });

            outputLang.addEventListener('change', function() {
                currentOutputLang = this.value;
                updateLanguageIndicator();
            });
        }

        // Handle Enter key in input field
        document.getElementById('textInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendText();
            }
        });

        // Add this function for text-to-speech
        function toggleTextToSpeech() {
            const textInput = document.getElementById('textInput');
            const text = textInput.value.trim();
            const voiceButton = document.getElementById('voiceButton');
            
            if (!text) {
                addMessage('Please enter text to speak', false);
                return;
            }

            if (isSpeaking) {
                // Stop speaking
                speechSynthesis.cancel();
                isSpeaking = false;
                voiceButton.innerHTML = '<i class="fas fa-volume-up"></i>';
                voiceButton.classList.remove('speaking');
            } else {
                // Start speaking
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Set the language based on the current output language
                utterance.lang = currentOutputLang;
                
                utterance.onend = function() {
                    isSpeaking = false;
                    voiceButton.innerHTML = '<i class="fas fa-volume-up"></i>';
                    voiceButton.classList.remove('speaking');
                };

                utterance.onerror = function(event) {
                    console.error('Speech synthesis error:', event.error);
                    addMessage('Error in text-to-speech. Please try again.', false);
                    isSpeaking = false;
                    voiceButton.innerHTML = '<i class="fas fa-volume-up"></i>';
                    voiceButton.classList.remove('speaking');
                };

                // Start speaking
                currentUtterance = utterance;
                speechSynthesis.speak(utterance);
                isSpeaking = true;
                voiceButton.innerHTML = '<i class="fas fa-volume-mute"></i>';
                voiceButton.classList.add('speaking');
            }
        }

        // Clean up speech synthesis when the page unloads
        window.addEventListener('unload', function() {
            if (speechSynthesis) {
                speechSynthesis.cancel();
            }
        });

        function toggleTranslateBox() {
            const translateBox = document.getElementById('translateBox');
            translateBox.classList.toggle('active');
            if (translateBox.classList.contains('active')) {
                document.getElementById('quickLangInput').focus();
            }
        }

        async function quickTranslate() {
            const textInput = document.getElementById('textInput');
            const text = textInput.value.trim();
            const targetLang = document.getElementById('quickLangInput').value.trim();
            
            if (!text || !targetLang) {
                addMessage('Please enter both text and target language.', false);
                return;
            }

            addMessage(text, true);
            showLoading();
            
            try {
                const languagePrompt = `Please translate the following text to ${targetLang}. Only respond with the direct translation, no additional text: `;
                const response = await window.api.sendText(languagePrompt + text);
                addMessage(response);
                
                // Speak the translated text
                const utterance = new SpeechSynthesisUtterance(response);
                
                // Try to match the language code for speech
                const langCode = getLangCodeForSpeech(targetLang);
                utterance.lang = langCode;
                
                utterance.onend = function() {
                    isSpeaking = false;
                    document.getElementById('voiceButton').innerHTML = '<i class="fas fa-volume-up"></i>';
                    document.getElementById('voiceButton').classList.remove('speaking');
                };

                utterance.onerror = function(event) {
                    console.error('Speech synthesis error:', event.error);
                    addMessage('Error in text-to-speech. Please try again.', false);
                    isSpeaking = false;
                    document.getElementById('voiceButton').innerHTML = '<i class="fas fa-volume-up"></i>';
                    document.getElementById('voiceButton').classList.remove('speaking');
                };

                speechSynthesis.speak(utterance);
                isSpeaking = true;
                document.getElementById('voiceButton').innerHTML = '<i class="fas fa-volume-mute"></i>';
                document.getElementById('voiceButton').classList.add('speaking');
                
                toggleTranslateBox(); // Hide the translate box after translation
            } catch (error) {
                addMessage('Error: ' + error);
            } finally {
                hideLoading();
                textInput.value = '';
            }
        }

        // Helper function to get the appropriate language code for speech synthesis
        function getLangCodeForSpeech(language) {
            const langMap = {
                'english': 'en-US',
                'spanish': 'es-ES',
                'french': 'fr-FR',
                'german': 'de-DE',
                'italian': 'it-IT',
                'portuguese': 'pt-PT',
                'russian': 'ru-RU',
                'japanese': 'ja-JP',
                'korean': 'ko-KR',
                'chinese': 'zh-CN',
                'hindi': 'hi-IN',
                'arabic': 'ar-SA'
            };
            
            const langKey = language.toLowerCase();
            return langMap[langKey] || 'en-US';
        }

        // Add event listener for Enter key in quick language input
        document.getElementById('quickLangInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                quickTranslate();
            }
        });

        // Initialize speech recognition
        function initializeSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                addMessage('Speech recognition is not supported in this browser.', false);
                return;
            }

            try {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();

                recognition.continuous = false;
                recognition.interimResults = true;
                recognition.lang = currentInputLang === 'auto' ? 'en-US' : currentInputLang;
                recognition.maxAlternatives = 1;

                let finalTranscript = '';
                let retryCount = 0;
                const maxRetries = 3;

                recognition.onstart = function() {
                    finalTranscript = '';
                    isRecording = true;
                    document.getElementById('micButton').classList.add('recording');
                    document.getElementById('voiceIndicator').classList.add('active');
                };

                recognition.onresult = function(event) {
                    let interimTranscript = '';
                    retryCount = 0; // Reset retry count on successful result
                    
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        } else {
                            interimTranscript += transcript;
                        }
                    }

                    if (finalTranscript) {
                        document.getElementById('textInput').value = finalTranscript;
                    }
                };

                recognition.onend = function() {
                    const finalText = document.getElementById('textInput').value;
                    if (finalText.trim()) {
                        addMessage(finalText, true);
                        sendText();
                    }
                    stopVoiceRecognition();
                };

                recognition.onerror = async function(event) {
                    console.error('Speech recognition error:', event.error);
                    
                    switch (event.error) {
                        case 'network':
                            if (retryCount < maxRetries) {
                                retryCount++;
                                addMessage(`Network error. Retrying... (Attempt ${retryCount}/${maxRetries})`, false);
                                // Wait a moment before retrying
                                await new Promise(resolve => setTimeout(resolve, 1000));
                                try {
                                    recognition.start();
                                    return;
                                } catch (error) {
                                    console.error('Retry failed:', error);
                                }
                            }
                            addMessage('Network error. Please check your internet connection and try again.', false);
                            break;
                        case 'no-speech':
                            addMessage('No speech detected. Please try again.', false);
                            break;
                        case 'audio-capture':
                            addMessage('No microphone found. Please check your microphone settings.', false);
                            // Try to reinitialize audio
                            await reinitializeAudio();
                            break;
                        case 'not-allowed':
                        case 'permission-denied':
                            addMessage('Microphone access denied. Please allow microphone access in your browser settings.', false);
                            // Show instructions for enabling microphone
                            showMicrophoneInstructions();
                            break;
                        case 'aborted':
                            // Only show message if it wasn't intentionally stopped
                            if (isRecording) {
                                addMessage('Voice recognition was interrupted. Please try again.', false);
                            }
                            break;
                        default:
                            addMessage(`Error: ${event.error}. Please try again.`, false);
                    }
                    stopVoiceRecognition();
                };

            } catch (error) {
                console.error('Error initializing speech recognition:', error);
                addMessage('Could not initialize speech recognition. Please refresh the page and try again.', false);
            }
        }

        async function reinitializeAudio() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                stream.getTracks().forEach(track => track.stop()); // Clean up the test stream
                addMessage('Microphone access restored. Please try again.', false);
                return true;
            } catch (error) {
                console.error('Audio reinitialization failed:', error);
                return false;
            }
        }

        function showMicrophoneInstructions() {
            const instructions = `
                To enable microphone access:
                1. Click the camera/microphone icon in your browser's address bar
                2. Select "Allow" for microphone access
                3. Refresh the page and try again
            `;
            addMessage(instructions, false);
        }

        async function toggleVoiceRecognition() {
            if (!recognition) {
                initializeSpeechRecognition();
            }

            if (!isRecording) {
                try {
                    // First check if we have audio devices
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    const hasAudioDevice = devices.some(device => device.kind === 'audioinput');
                    
                    if (!hasAudioDevice) {
                        addMessage('No microphone detected. Please connect a microphone and try again.', false);
                        return;
                    }

                    const permissionStatus = await navigator.permissions.query({ name: 'microphone' });
                    if (permissionStatus.state === 'granted') {
                        startVoiceRecognition();
                    } else if (permissionStatus.state === 'prompt') {
                        try {
                            // Request microphone access explicitly
                            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                            stream.getTracks().forEach(track => track.stop()); // Clean up the test stream
                            startVoiceRecognition();
                        } catch (error) {
                            console.error('Microphone access error:', error);
                            addMessage('Microphone access denied. Please allow microphone access and try again.', false);
                        }
                    } else {
                        showMicrophoneInstructions();
                    }
                } catch (error) {
                    console.error('Permission check error:', error);
                    // Fallback to traditional method
                    try {
                        recognition.start();
                    } catch (startError) {
                        console.error('Recognition start error:', startError);
                        addMessage('Error starting voice recognition. Please refresh and try again.', false);
                    }
                }
            } else {
                stopVoiceRecognition();
            }
        }

        function startVoiceRecognition() {
            if (recognition) {
                try {
                    recognition.start();
                } catch (error) {
                    console.error('Error starting recognition:', error);
                    addMessage('Error starting voice recognition. Please try again.', false);
                    stopVoiceRecognition();
                }
            }
        }

        function stopVoiceRecognition() {
            if (recognition) {
                isRecording = false;
                document.getElementById('micButton').classList.remove('recording');
                document.getElementById('voiceIndicator').classList.remove('active');
                try {
                    recognition.stop();
                } catch (error) {
                    console.error('Error stopping recognition:', error);
                }
            }
        }

        // Initialize voice recognition when the page loads
        window.addEventListener('load', function() {
            initializeSpeechRecognition();
            setupLanguageSelectors();
            updateLanguageIndicator();
        });

        // Weather functionality
        const api_key = "56b29af3c7df432caf8120133250703"; // WeatherAPI.com API key

        function toggleWeather() {
            const weatherContainer = document.getElementById('weatherContainer');
            weatherContainer.style.display = weatherContainer.style.display === 'none' ? 'block' : 'none';
            if (weatherContainer.style.display === 'block') {
                searchWeather('London'); // Default city
            }
        }

        async function searchWeather(defaultCity = null) {
            const cityInput = document.getElementById('cityInput');
            const city = defaultCity || cityInput.value.trim();
            
            if (!city) {
                showNotification('Please enter a city name');
                return;
            }

            const url = `https://api.weatherapi.com/v1/current.json?key=${api_key}&q=${encodeURIComponent(city)}&aqi=no`;
            
            try {
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            showNotification('Please enter a valid city name');
                            return;
                        }
                        updateWeatherUI(data);
                    })
                    .catch(err => {
                        console.error("Error:", err);
                        showNotification('Error fetching weather data');
                    });
            } catch (err) {
                console.error("Error:", err);
                showNotification('Error fetching weather data');
            }
        }

        function updateWeatherUI(data) {
            const weatherContent = document.getElementById('weatherContent');
            const condition = data.current.condition.text.toLowerCase();
            const temp = data.current.temp_c;
            
            // Determine weather icon using the same logic as the React component
            let weatherIcon;
            if (condition.includes('snow') || (temp <= 0 && condition.includes('rain'))) {
                weatherIcon = 'Snow';
            } else if (condition.includes('rain') || condition.includes('drizzle')) {
                weatherIcon = 'Rain';
            } else if (condition.includes('cloud') || condition.includes('overcast')) {
                weatherIcon = 'cloud';
            } else if (condition.includes('sunny') || condition.includes('clear')) {
                weatherIcon = 'clear';
            } else {
                weatherIcon = 'clear'; // Default to clear icon if no specific condition is matched
            }

            weatherContent.innerHTML = `
                <div class="weather-icon">
                    <img src="Images/${weatherIcon}.jpeg" alt="Weather" />
                </div>
                <div class="weather-info">
                    <h1 class="city">${data.location.name}</h1>
                    <h2 class="temp">${Math.round(data.current.temp_c)}°C</h2>
                </div>
                <div class="weather-details">
                    <div class="col">
                        <img src="Images/Humidity.jpeg" alt="Humidity" />
                        <div>
                            <p class="humidity">${data.current.humidity}%</p>
                            <p>Humidity</p>
                        </div>
                    </div>
                    <div class="col">
                        <img src="Images/Wind.jpeg" alt="Wind" />
                        <div>
                            <p class="wind">${Math.round(data.current.wind_kph)} km/h</p>
                            <p>Wind Speed</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <p>${message}</p>
                <button onclick="this.parentElement.remove()">OK</button>
            `;
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function toggleCurrencyConverter() {
            const currencyConverter = document.getElementById('currencyConverter');
            currencyConverter.style.display = currencyConverter.style.display === 'none' ? 'block' : 'none';
        }

        function swapCurrencies() {
            const fromCurrency = document.getElementById('fromCurrency');
            const toCurrency = document.getElementById('toCurrency');
            
            // Swap the selected values
            const temp = fromCurrency.value;
            fromCurrency.value = toCurrency.value;
            toCurrency.value = temp;
            
            // Trigger conversion with new values
            convertCurrency();
        }

        function convertCurrency() {
            const amount = document.getElementById('amount');
            const fromCurrency = document.getElementById('fromCurrency');
            const toCurrency = document.getElementById('toCurrency');
            const result = document.getElementById('result');
            
            const fromCode = fromCurrency.value;
            const toCode = toCurrency.value;
            const amountValue = parseFloat(amount.value);
            
            if (isNaN(amountValue)) {
                result.value = 'Invalid amount';
                return;
            }

            // Show loading state
            result.value = 'Converting...';
            
            // Using Frankfurter API - free and no API key required
            fetch(`https://api.frankfurter.app/latest?amount=${amountValue}&from=${fromCode}&to=${toCode}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        result.value = 'Error: ' + data.error;
                        return;
                    }
                    result.value = data.rates[toCode].toFixed(2);
                })
                .catch(error => {
                    console.error('Conversion error:', error);
                    result.value = 'Error fetching rates';
                });
        }

        // Add event listener for amount input to trigger conversion on change
        document.getElementById('amount').addEventListener('input', convertCurrency);
        document.getElementById('fromCurrency').addEventListener('change', convertCurrency);
        document.getElementById('toCurrency').addEventListener('change', convertCurrency);

        function toggleEmergencyNumbers() {
            const emergencyNumbers = document.getElementById('emergencyNumbers');
            emergencyNumbers.style.display = emergencyNumbers.style.display === 'none' ? 'block' : 'none';
            if (emergencyNumbers.style.display === 'block') {
                loadEmergencyNumbers();
            }
        }

        function loadEmergencyNumbers() {
            const emergencyData = {
                'United States': { police: '911', ambulance: '911', fire: '911' },
                'United Kingdom': { police: '999/112', ambulance: '999/112', fire: '999/112' },
                'Australia': { police: '000', ambulance: '000', fire: '000' },
                'India': { police: '100', ambulance: '102', fire: '101' },
                'Japan': { police: '110', ambulance: '119', fire: '119' },
                'China': { police: '110', ambulance: '120', fire: '119' },
                'France': { police: '17', ambulance: '15', fire: '18' },
                'Germany': { police: '110', ambulance: '112', fire: '112' },
                'Canada': { police: '911', ambulance: '911', fire: '911' },
                'Italy': { police: '113', ambulance: '118', fire: '115' },
                'Spain': { police: '091', ambulance: '061', fire: '080' },
                'Brazil': { police: '190', ambulance: '192', fire: '193' },
                'Russia': { police: '102', ambulance: '103', fire: '101' },
                'South Korea': { police: '112', ambulance: '119', fire: '119' },
                'Mexico': { police: '911', ambulance: '911', fire: '911' },
                'Singapore': { police: '999', ambulance: '995', fire: '995' },
                'UAE': { police: '999', ambulance: '998', fire: '997' },
                'South Africa': { police: '10111', ambulance: '10177', fire: '10177' },
                'New Zealand': { police: '111', ambulance: '111', fire: '111' },
                'Thailand': { police: '191', ambulance: '1669', fire: '199' }
            };
            displayEmergencyNumbers(emergencyData);
        }

        function displayEmergencyNumbers(data) {
            const emergencyList = document.getElementById('emergencyList');
            emergencyList.innerHTML = '';
            
            Object.entries(data).forEach(([country, numbers]) => {
                const countryDiv = document.createElement('div');
                countryDiv.className = 'country-item';
                countryDiv.innerHTML = `
                    <h4>${country}</h4>
                    <p>Police: ${numbers.police}</p>
                    <p>Ambulance: ${numbers.ambulance}</p>
                    <p>Fire: ${numbers.fire}</p>
                `;
                emergencyList.appendChild(countryDiv);
            });
        }

        function filterCountries() {
            const searchInput = document.getElementById('countrySearch').value.toLowerCase();
            const countryItems = document.querySelectorAll('.country-item');
            
            countryItems.forEach(item => {
                const countryName = item.querySelector('h4').textContent.toLowerCase();
                if (countryName.includes(searchInput)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function toggleHolidayPlanner() {
            const holidayPlanner = document.getElementById('holidayPlanner');
            holidayPlanner.style.display = holidayPlanner.style.display === 'none' ? 'block' : 'none';
        }

        async function generatePlan() {
            const destinationInput = document.getElementById('destination');
            const daysInput = document.getElementById('days');
            const plannerResult = document.getElementById('plannerResult');
            const destination = destinationInput.value.trim();
            const days = parseInt(daysInput.value);
            
            if (!destination || isNaN(days) || days < 1 || days > 30) {
                alert('Please enter a valid destination and number of days (1-30).');
                return;
            }

            try {
                plannerResult.innerHTML = '<div class="loading">Generating your personalized travel plan</div>';
                plannerResult.style.display = 'block';

                const plan = await window.api.generateHolidayPlan(destination, days);
                
                // Convert the plan text to HTML with proper formatting
                const formattedPlan = plan.split('\n').map(line => {
                    if (line.startsWith('Day')) {
                        return `<h4 class="day-title">${line}</h4>`;
                    } else if (line.startsWith('Morning') || line.startsWith('Afternoon') || line.startsWith('Evening')) {
                        return `<h5 class="time-title">${line}</h5>`;
                    } else if (line.trim().startsWith('•') || line.trim().startsWith('-')) {
                        return `<li>${line.trim().substring(1).trim()}</li>`;
                    } else if (line.trim() === '') {
                        return '</ul><ul>';
                    } else {
                        return `<p>${line}</p>`;
                    }
                }).join('');

                plannerResult.innerHTML = `
                    <div class="plan-container">
                        <h3>${destination} - ${days} Day Itinerary</h3>
                        <div class="plan-content">
                            ${formattedPlan}
                        </div>
                    </div>
                `;

                // Add styles for the new elements
                const style = document.createElement('style');
                style.textContent = `
                    .plan-container {
                        background: rgba(255, 255, 255, 0.05);
                        border-radius: 10px;
                        padding: 20px;
                    }

                    .plan-content {
                        margin-top: 20px;
                    }

                    .day-title {
                        color: #4CAF50;
                        margin: 20px 0 10px 0;
                        font-size: 1.2em;
                    }

                    .time-title {
                        color: #81C784;
                        margin: 15px 0 5px 0;
                        font-size: 1.1em;
                    }

                    .plan-content ul {
                        list-style-type: none;
                        padding-left: 20px;
                        margin: 5px 0;
                    }

                    .plan-content li {
                        margin: 5px 0;
                        line-height: 1.4;
                    }

                    .plan-content p {
                        margin: 10px 0;
                        line-height: 1.4;
                    }
                `;
                document.head.appendChild(style);

            } catch (error) {
                plannerResult.innerHTML = `
                    <div class="error-message">
                        Sorry, there was an error generating your travel plan. Please try again.
                    </div>
                `;
                console.error('Error:', error);
            }
        }

        function toggleMap() {
            const mapContainer = document.getElementById('mapContainer');
            mapContainer.classList.toggle('active');

            if (mapContainer.classList.contains('active') && !map) {
                initializeMap();
            }
        }

        function initializeMap() {
            // Initialize the map
            map = L.map('map').setView([20, 0], 2);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // Handle route form submission
            document.getElementById('routeForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const source = document.getElementById('sourceLocation').value;
                const destination = document.getElementById('destLocation').value;
                await calculateRoute(source, destination);
            });

            // Handle transport mode selection
            document.querySelectorAll('.transport-mode-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.transport-mode-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentTransportMode = this.dataset.mode;
                    if (routingControl) {
                        updateRoute();
                    }
                });
            });
        }

        async function geocodeLocation(location) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}`);
                const data = await response.json();
                if (data.length > 0) {
                    return [parseFloat(data[0].lat), parseFloat(data[0].lon)];
                }
                throw new Error('Location not found');
            } catch (error) {
                console.error('Geocoding error:', error);
                throw error;
            }
        }

        async function calculateRoute(source, destination) {
            try {
                const sourceCoords = await geocodeLocation(source);
                const destCoords = await geocodeLocation(destination);

                if (routingControl) {
                    map.removeControl(routingControl);
                }

                routingControl = L.Routing.control({
                    waypoints: [
                        L.latLng(sourceCoords[0], sourceCoords[1]),
                        L.latLng(destCoords[0], destCoords[1])
                    ],
                    router: L.Routing.osrmv1({
                        serviceUrl: 'https://router.project-osrm.org/route/v1',
                        profile: currentTransportMode
                    }),
                    lineOptions: {
                        styles: [{ color: '#4CAF50', weight: 4 }]
                    },
                    show: false,
                    addWaypoints: false,
                    draggableWaypoints: true,
                    fitSelectedRoutes: true
                }).addTo(map);

                routingControl.on('routesfound', function(e) {
                    const routes = e.routes;
                    const route = routes[0];
                    const distance = (route.summary.totalDistance / 1000).toFixed(2);
                    const time = Math.round(route.summary.totalTime / 60);
                    
                    // You can display route information here if needed
                    console.log(`Distance: ${distance} km, Time: ${time} minutes`);
                });
            } catch (error) {
                console.error('Route calculation error:', error);
                alert('Error calculating route. Please check your locations and try again.');
            }
        }

        function updateRoute() {
            if (routingControl) {
                const waypoints = routingControl.getWaypoints();
                if (waypoints[0].latLng && waypoints[1].latLng) {
                    calculateRoute(
                        `${waypoints[0].latLng.lat},${waypoints[0].latLng.lng}`,
                        `${waypoints[1].latLng.lat},${waypoints[1].latLng.lng}`
                    );
                }
            }
        }
    </script>
</body>
</html> 